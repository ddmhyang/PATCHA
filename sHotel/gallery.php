<?php
session_start(); // 이 줄을 추가하세요!
require_once 'includes/db.php';

// sHotel의 'gallery' 테이블에서 데이터를 가져옵니다.
$posts_query = "SELECT id, title, thumbnail FROM gallery ORDER BY created_at DESC";
$posts_result = $mysqli->query($posts_query);
$posts = [];
if ($posts_result->num_rows > 0) {
    while($row = $posts_result->fetch_assoc()) {
        $posts[] = $row;
    }
}
?>

<div class="gallery-container">
    <div id="gallery-content">
        <h2>Gallery</h2>
        <div class="gallery_line"></div>
        <?php // 로그인 상태일 때만 '게시글 추가하기' 버튼 표시
        if (isset($_SESSION['loggedin']) && $_SESSION['loggedin'] === true): ?>
            <a href="index.php?page=gallery_upload" class="add-btn">Add</a>
        <?php endif; ?>
        
        <div class="gallery-grid">
            <?php foreach ($posts as $post): ?>
                <a href="index.php?page=gallery_view&id=<?php echo $post['id']; ?>" class="gallery-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="226" height="254" viewBox="0 0 226 254" fill="none">
                        <path d="M1 31C1 14.4315 14.4315 1 31 1H195C211.569 1 225 14.4315 225 31V223C225 239.569 211.569 253 195 253H31C14.4315 253 1 239.569 1 223V31Z" fill="black" fill-opacity="0.5"/>
                        <path d="M39.5773 0.0101698C44.6235 -0.015883 51.2382 0.0119737 56.2653 0.0502087C57.8408 0.0620673 57.043 0.115075 58.1306 0.125648C60.2577 0.146258 62.2393 0.120261 64.3414 0.144813C65.038 0.153209 64.1708 0.237174 64.9013 0.244056C68.9041 0.281163 72.6908 0.259777 76.7457 0.277625C96.7187 0.365685 116.352 0.397205 136.569 0.435461C143.235 0.448004 151.339 0.524206 158.224 0.490881C159.028 0.486916 158.549 0.413216 158.702 0.407141C161.1 0.31415 160.303 0.462935 161.869 0.482702C168.085 0.560754 174.997 0.567542 180.979 0.539099C183.524 0.526782 180.972 0.380395 183.534 0.462561C183.712 0.468112 183.067 0.546377 183.764 0.554724C185.347 0.573498 188.35 0.559509 189.577 0.56571C191.941 0.578057 192.332 0.577269 194.568 0.578161C194.711 0.57825 194.855 0.578419 195 0.57866C198.011 0.56682 201.497 1.12661 204.508 2.11786C205.182 2.34145 204.319 1.95691 205.393 2.32018C206.483 2.65722 209.209 3.93774 210.061 4.49003C210.928 5.01426 210.521 4.8545 210.668 4.95721C211.894 5.76972 214.725 7.76029 215.04 8.08788C221.18 13.4537 224.42 20.2662 225.251 27.8279C225.359 28.8679 225.416 29.9278 225.417 31C225.425 35.7713 225.446 40.6786 225.442 45.1342C225.437 51.6145 225.393 57.1068 225.401 63.4023C225.402 64.0667 225.496 63.2882 225.497 64.0997C225.508 72.7211 225.498 81.2825 225.434 89.8668C225.427 90.7277 225.345 89.6182 225.333 90.4782C225.265 95.7442 225.102 104.076 225.462 107.204C225.448 110.771 225.434 115.102 225.361 118.293C225.314 120.35 225.224 118.352 225.262 120.879C225.271 121.449 225.35 120.708 225.357 121.563C225.386 125.162 225.36 129.094 225.401 132.655C225.409 133.379 225.48 133.181 225.493 133.387C225.596 135.111 225.426 137.982 225.413 138.608C225.321 143.374 225.357 146.854 225.355 151.294C225.354 152.324 225.449 151.107 225.452 152.098C225.466 157.24 225.458 162.566 225.415 167.601C225.406 168.721 225.325 167.691 225.316 168.226C225.279 170.586 225.432 171.109 225.399 173.372C225.392 173.849 225.322 173.58 225.315 173.667C225.195 175.029 225.365 176.213 225.368 176.563C225.419 180.995 225.243 183.827 225.268 188.109C225.271 188.621 225.359 187.466 225.362 188.906C225.386 198.497 225.362 208.641 225.292 218.135C225.281 219.611 225.215 218.558 225.207 218.651C225.08 220.165 225.25 221.144 225.257 221.626C225.262 222.088 225.265 222.546 225.266 223C225.28 226.316 224.623 229.297 224.145 231.539C220.56 244.188 208.069 253.569 195 253.302C191.844 253.285 188.69 253.261 185.539 253.225C185.336 253.223 185.699 253.139 185.295 253.135C180.424 253.088 181.359 253.218 178.136 253.378C177.324 253.418 174.854 253.225 174.636 253.211C173.84 253.159 174.665 253.035 174.399 253.025C172.192 252.946 172.552 253.358 169.576 253.358C169.483 253.357 169.874 253.281 169.624 253.274C168.848 253.25 168.078 253.28 167.319 253.254C165.581 253.194 164.962 252.993 162.307 253.11C161.971 253.125 162.484 253.359 159.827 253.348C158.767 253.343 154.078 253.347 152.764 253.332C151.451 253.317 152.353 253.242 152.259 253.238C148.722 253.139 150.063 253.097 148.292 252.95C146.52 252.803 147.011 253.153 146.289 253.193C145.565 253.232 142.972 253.149 142.335 253.121C141.698 253.092 142.492 253.044 141.926 253.028C138.171 252.922 140.278 253.202 139.041 253.258C136.124 253.389 133.852 253.13 131.181 253.104C130.458 253.097 131.048 253.156 130.405 253.162C127.856 253.183 126.324 253.102 123.424 253.176C122.95 253.188 120.606 253.345 119.089 253.23C118.874 253.214 119.485 253.149 118.399 253.134C116.776 253.112 113.853 253.098 112.109 253.12C110.821 253.136 112.297 253.243 110.677 253.21C109.956 253.195 111.291 253.132 109.938 253.11C108.592 253.087 105.15 253.09 103.841 253.092C102.533 253.094 103.249 253.175 103.143 253.181C102.504 253.212 99.9952 253.251 99.7734 253.251C88.5905 253.261 78.2782 253.124 67.3902 253.169C66.5358 253.173 67.1049 253.258 66.9746 253.26C64.0494 253.295 66.3557 253.068 64.3123 252.992C64.6077 253.166 63.4014 253.134 61.3409 253.153C60.348 253.163 60.8888 253.23 60.7982 253.237C59.3257 253.338 58.3004 253.207 58.0363 253.18C57.0611 253.081 55.9999 253.198 55.3363 253.132C54.6731 253.066 56.1994 252.969 54.2233 252.97C53.6691 253.032 55.1362 253.194 53.6359 253.22C47.975 253.32 37.4082 253.192 32.8566 253.179C32.1729 253.177 31.5589 253.176 31 253.175C27.8244 253.126 26.4244 252.879 24.2206 252.39C19.599 251.091 21.2579 251.655 18.464 250.582C15.7313 249.322 17.1951 249.68 16.837 249.436C16.4979 249.182 16.0655 249.015 15.6356 248.717C15.2098 248.418 16.1907 248.966 15.1576 248.317C14.1013 247.704 11.4046 245.726 11.0602 245.451C10.2976 244.923 11.2523 246.126 8.98381 243.766C8.85754 243.627 9.3307 244.018 8.84547 243.488C4.99542 239.275 2.26817 233.76 1.37948 228.144C1.25883 227.371 1.45712 228.047 1.39087 227.597C0.944725 223.713 1.0456 224.202 0.868067 223C0.842332 222.755 0.815217 222.438 0.787633 221.997C1.00337 222.579 1.13536 221.147 1.13663 217.563C1.13747 215.408 1.04325 215.779 0.976842 214.385C0.956823 213.967 1.02152 212.442 0.977208 212.166C0.83236 211.255 0.670211 212.691 0.734777 208.995C0.737845 208.833 0.817133 209.35 0.821935 208.789C0.853365 205.168 0.701856 204.734 0.683508 200.82C0.669111 197.751 0.761499 192.294 0.776525 188.8C1.01907 188.874 0.963534 185.573 0.7963 184.235C0.803147 181.967 0.793693 179.518 0.816808 177.327C0.824689 176.572 0.894913 177.068 0.902501 176.973C1.02153 175.514 0.858831 174.529 0.852452 174.039C0.790448 168.735 0.913761 164.413 0.793248 159.351C0.788908 159.171 0.620425 158.88 0.743444 157.527C0.751924 157.439 0.82858 159.111 0.834508 156.73C0.840449 154.348 0.930768 149.858 0.852696 146.551C0.833901 145.751 0.697128 143.727 0.803991 142.103C0.818502 141.886 0.866823 142.123 0.893712 141.811C0.979391 140.801 0.809097 140.249 0.95377 139.063C1.09844 137.876 1.20678 135.407 1.10697 132.072C1.10407 131.966 0.969092 131.176 0.971226 130.128C0.974749 128.454 1.00287 126.077 1.00199 124.329C1.00152 123.492 0.917706 124.028 0.916173 123.883C0.869207 118.255 0.943926 114.25 0.976353 108.222C0.982464 107.117 0.868173 103.941 0.958531 101.801C1.05745 99.4523 1.46891 101.866 1.37088 96.4667C1.33167 94.2887 0.809653 91.5315 1.08011 87.6177C1.01309 80.0271 1.15151 73.0074 1.05582 65.3957C1.05158 65.0534 0.905889 63.971 0.907872 63.1663C0.911098 61.9716 0.979192 61.3158 0.983677 60.4628C1.00419 56.8884 0.945929 53.6174 0.954991 50.1711C0.958284 48.8627 1.02869 49.3202 1.03263 47.7596C1.0365 46.2 0.943782 45.1601 0.98856 43.0466C1.02269 41.4504 1.2122 39.8545 1.23429 37.7358C1.04736 37.6551 1.05121 36.1999 1.00187 33.6137C0.992292 33.1165 0.927231 33.6496 0.919347 33.4144C0.889972 32.5761 0.927708 31.7924 0.91298 31C0.910895 30.8869 0.908383 30.7737 0.905112 30.6603C0.899166 30.4378 0.835752 30.4262 0.829144 30.244C0.742659 28.6882 1.22967 26.1744 1.35009 25.7531C1.74414 24.1291 1.86884 23.3537 2.27161 22.1379C2.69591 20.9307 2.15289 22.7628 2.63818 21.353C3.6411 18.4344 5.54033 14.9129 7.51374 12.4778C8.29754 11.5064 7.6974 12.1154 7.80788 11.975C9.42851 9.94418 11.457 8.27377 12.491 7.26562C14.2021 6.55987 13.6515 6.18696 16.9361 4.43566C17.1997 4.30709 17.6154 4.31397 16.6517 4.86792C15.6907 5.42492 14.22 6.26432 13.0213 7.24051C12.7216 7.45692 11.2469 8.944 11.0606 9.15569C9.50555 10.7353 9.11503 10.8036 9.01117 10.8703C7.94054 11.721 6.56107 13.9117 6.22375 14.4883C4.57752 17.0869 3.45492 19.4709 2.70917 21.9307C2.24515 23.5462 2.41682 23.7574 2.13045 25.0351C1.60564 27.6208 1.42021 29.2241 1.37578 31C1.35701 32.1625 1.37189 33.3965 1.46842 35.0358C1.52083 35.9306 1.74287 35.0414 1.56827 38.2477C1.55726 38.4491 1.39754 40.8296 1.49857 42.205C1.51131 42.3777 1.57602 42.3722 1.58145 42.6C1.61662 44.1267 1.56506 45.1449 1.58975 46.8081C1.61445 48.4711 1.65125 50.4708 1.62931 52.3696C1.61618 53.5139 1.49561 54.9821 1.4661 55.5299C1.38107 57.0766 1.52048 58.7351 1.41751 59.6933C1.31403 60.6596 1.15687 58.7705 1.09 61.3044C1.25812 61.3982 1.43069 61.6138 1.59976 61.7647C1.59384 67.3177 1.53948 72.7815 1.54691 78.3531C1.548 79.0438 1.63838 78.3374 1.64188 79.0779C1.65624 82.2021 1.59181 84.9309 1.61746 88.1708C1.63767 90.6786 1.73337 93.4286 1.75748 96.051C1.5651 97.6528 1.63041 101.544 1.61283 104.371C1.60675 105.361 1.55537 105.295 1.53861 105.999C1.47661 108.656 1.64662 107.411 1.67337 108.139C1.78756 111.264 1.40276 111.532 1.41226 115.216C1.41264 115.411 1.61775 117.797 1.63053 118.125C1.71382 120.213 1.55913 118.471 1.54398 119.778C1.51628 122.163 1.4673 123.821 1.52738 126.62C1.54517 127.437 1.67302 129.395 1.57413 130.98C1.56118 131.188 1.49338 131.073 1.48941 131.241C1.42323 134.279 1.63626 134.359 1.70841 136.095C1.78054 137.831 1.63348 140.513 1.5911 141.058C1.48145 142.486 1.54424 139.964 1.53348 139.887C1.40543 138.979 1.42748 140.935 1.41666 142.429C1.20778 142.645 1.22032 144.735 1.40628 143.978C1.4266 143.892 1.40712 142.729 1.41666 142.429C1.6216 143.741 1.64784 146.038 1.45633 148.574C1.36657 149.762 1.26192 148.639 1.3002 152.247C1.31749 153.884 1.46131 153.251 1.50052 154.696C1.58999 157.997 1.45582 162.286 1.47696 165.688C1.48464 166.923 1.56336 165.72 1.57132 166.564C1.59269 168.804 1.53362 170.78 1.56388 173.029C1.56672 173.233 1.64913 172.735 1.65018 173.435C1.65975 178.738 1.60696 183.356 1.6055 188.893C1.60483 191.568 1.65028 196.351 1.64115 199.123C1.62579 203.926 1.50595 209.835 1.53507 213.939C1.5537 216.615 1.63613 216.028 1.69229 217.174C1.77628 218.882 1.67941 221.603 1.61689 223C1.59844 223.408 1.59091 223.7 1.58711 223.818C1.58671 223.825 1.57072 223.389 1.56346 223C1.55333 222.503 1.53684 222.088 1.51322 222.774C1.5033 222.854 1.4964 222.93 1.49197 223C1.45787 223.551 1.58688 223.796 1.58711 223.818C1.49397 224.16 1.96785 228.663 2.27715 229.518C2.39487 229.99 2.4096 229.707 2.47122 229.952C3.95235 235.788 7.23512 241.142 11.8236 245.158C11.9038 245.23 11.7238 245.19 11.9142 245.357C14.6075 247.66 16.6666 248.718 19.3362 249.847C22.0294 250.945 24.2668 251.491 25.9387 251.937C27.4103 252.187 29.3372 252.393 31 252.416C31.8011 252.431 32.5387 252.446 33.1349 252.459C34.9902 252.499 35.2492 252.329 35.4124 252.326C40.5043 252.218 43.4478 252.316 48.7305 252.331C51.242 252.338 56.2239 252.314 58.9432 252.295C61.0923 252.28 62.387 252.32 64.3673 252.294C64.6352 252.291 64.3645 252.215 64.4463 252.212C66.6564 252.122 65.5942 252.307 66.0505 252.34C67.7048 252.46 68.7269 252.524 71.5571 252.468C72.2098 252.455 74.1114 252.188 75.3014 252.173C76.8486 252.153 76.2646 252.248 77.8846 252.225C78.0232 252.223 77.9944 252.164 78.9942 252.167C83.6352 252.178 88.6951 252.213 93.518 252.207C94.1768 252.206 93.3322 252.113 94.284 252.11C98.7504 252.099 103.646 252.103 107.997 252.146C109.068 252.157 108.397 252.223 108.629 252.242C110.057 252.36 112.081 252.189 112.415 252.186C120.382 252.104 126.479 252.258 134.599 252.185C135.041 252.18 138.443 251.997 139.961 252.154C140.065 252.165 141.567 252.325 142.895 252.216C142.977 252.209 142.042 252.126 143.675 252.134C145.308 252.143 147.936 252.088 150.181 252.178C150.892 252.207 152.571 252.367 154.691 252.24C154.829 252.231 158.102 251.942 159.27 252.141C159.46 252.174 159.261 252.385 161.792 252.277C162.275 252.256 161.398 252.209 162.671 252.179C164.622 252.134 167.208 252.191 169.607 252.097C170.025 252.08 171.806 251.937 173.234 252.045C173.458 252.062 173.033 252.133 173.787 252.141C177.374 252.179 181.131 252.131 184.773 252.18C186.063 252.197 185.403 252.311 186.748 252.342C188.093 252.372 190.803 252.401 192.21 252.349C193.618 252.297 192.08 252.116 194.189 252.101C194.459 252.1 194.73 252.098 195 252.096C203.635 252.095 212.124 248.156 217.593 241.437C218.412 240.403 217.712 241.24 218.851 239.67C221.671 235.86 224.202 229.046 224.087 223C224.098 219.84 224.122 216.953 224.169 214.79C224.279 209.661 224.363 216.115 224.408 212.196C224.43 210.305 224.219 208.259 224.212 207.802C224.145 203.343 224.238 200.243 224.21 196.229C224.204 195.401 224.118 196.213 224.114 195.508C224.099 193.098 224.137 190.566 224.13 188.263C224.127 187.23 224.062 187.421 224.067 186.47C224.078 184.196 224.105 182.185 224.167 179.967C224.172 179.765 224.254 181.128 224.257 179.445C224.261 176.722 224.322 173.341 224.259 170.208C224.24 169.278 224.091 169.242 224.194 167.244C224.216 166.824 224.395 167.359 224.24 165.031C224.214 164.64 224.006 160.729 224.14 158.81C224.176 158.304 224.322 157.012 224.299 155.894C224.296 155.742 224.215 156.35 224.208 155.423C224.181 152.158 224.19 148.737 224.165 145.382C224.158 144.487 224.075 145.821 224.067 144.486C224.047 140.815 224.068 136.231 224.094 132.641C224.103 131.318 224.172 132.233 224.18 132.136C224.301 130.588 224.137 129.672 224.127 129.158C224.07 125.961 224.147 123.527 224.127 120.58C224.121 119.767 224.043 120.344 224.036 120.182C223.968 118.503 224.108 119.754 224.124 118.691C224.168 115.714 224.162 112.396 224.152 109.385C224.148 108.28 224.057 109.522 224.055 108.53C224.039 102.656 224.048 96.5504 224.098 90.8183C224.107 89.739 224.177 90.418 224.193 90.1931C224.305 88.6427 224.153 86.3705 224.138 85.8476C224.072 83.4704 224.134 82.547 224.122 80.4476C224.065 70.1918 224.106 57.5288 224.131 47.848C224.147 41.7641 224.17 36.3376 224.188 31C224.198 25.429 222.698 19.8994 219.339 14.8393C218.922 14.223 219.267 14.8952 218.903 14.3688C214.177 7.59269 206.607 2.98408 198.365 2.0888C197.69 2.01827 198.651 2.20376 197.571 2.10517C196.774 2.03983 195.903 1.99989 195 2C193.339 1.9998 191.603 1.99135 190.109 1.9733C188.973 1.95974 190.497 1.88409 189.353 1.87198C186.691 1.84362 183.837 1.83734 181.102 1.85147C179.938 1.85768 181.694 1.94784 180.182 1.94888C169.877 1.95783 159.757 1.97336 149.344 1.8566C148.63 1.84858 148.004 1.66533 146.486 1.70047C146.372 1.75133 146.378 1.81115 146.328 1.86551C131.328 1.89479 116.48 1.83127 101.438 1.82144C100.803 1.82105 101.899 1.91815 100.672 1.91788C93.5648 1.91644 86.6636 1.94334 79.3942 1.84683C78.6729 1.8374 79.043 1.66658 76.9175 1.69242C76.5426 1.69713 73.3413 1.71991 72.5136 1.75699C72.4012 1.76258 72.9852 1.84231 71.9537 1.84464C65.9589 1.85674 59.6768 1.83854 53.6924 1.78983C52.7266 1.78181 53.7551 1.69691 53.0672 1.69046C48.1875 1.64539 42.8798 1.70993 38.217 1.63285C35.0959 1.58094 36.2514 1.43417 34.5929 1.28971C34.3584 1.26932 32.4257 1.26609 32.3257 1.18204C32.0691 0.970681 33.0053 0.739242 32.6212 0.513952C32.54 0.465427 29.9516 0.517692 31.4841 0.400427C31.5912 0.392579 33.4677 0.35366 33.9299 0.31388C34.2517 0.286376 33.6719 0.200894 34.3284 0.165687C34.9849 0.130513 35.7064 0.202169 36.7949 0.160804C37.8829 0.118927 37.4045 0.0216813 39.5773 0.0101698ZM41.4892 252.639C43.2072 252.721 43.4607 252.421 41.6025 252.493C41.5125 252.497 41.4006 252.635 41.4892 252.639ZM1.31388 72.7504C1.18195 74.9963 1.37593 76.5333 1.47782 74.9488C1.57959 73.3646 1.35387 72.0661 1.31388 72.7504ZM1.21756 49.46C1.11355 52.085 1.53768 52.4982 1.45194 49.6867C1.44709 49.5233 1.2236 49.3065 1.21756 49.46ZM42.2842 1.24857C42.2605 1.2446 40.8712 1.24073 40.838 1.24466C40.0983 1.33965 42.8763 1.34733 42.2842 1.24857ZM1.46713 26.383C1.25907 27.1771 1.14132 29.5315 1.29414 28.5255C1.39126 27.7187 1.69476 25.3906 1.46713 26.383ZM131.109 252.958C131.136 252.963 132.132 252.967 132.112 252.941C132.044 252.86 130.658 252.883 131.109 252.958ZM27.8233 1.27462C22.0975 2.01862 18.6566 3.1166 24.8021 1.41727C25.9259 1.17078 22.4127 2.08794 23.8432 1.78109C26.4484 1.23178 28.2083 0.794054 30.9496 0.879837C31.4368 0.870108 28.14 1.19419 27.8131 1.27619C27.8165 1.27567 27.8199 1.27514 27.8233 1.27462ZM42.4785 252.998C42.5128 253.002 43.8916 253.006 43.9247 253.002C44.6714 252.907 41.8937 252.899 42.4785 252.998ZM189.228 253.143C189.304 253.151 192.504 253.159 192.608 253.152C194.278 252.996 187.809 252.98 189.228 253.143ZM0.782995 188.745C0.68747 187.241 0.676223 185.441 0.796178 184.242C0.78981 185.737 0.788872 187.242 0.782995 188.745Z" fill="#77000E"/>
                    </svg>
                    <?php
                        // chanlan과 동일한 썸네일 표시 로직
                        $thumbnail_url = $post['thumbnail'] ?? '';
                        $style = !empty($thumbnail_url) 
                            ? "background-image: url('" . htmlspecialchars($thumbnail_url) . "');" 
                            : "background-color: #7078a700;"; // 썸네일이 없을 경우 기본 배경색
                    ?>
                    <div class="item-thumbnail" style="<?php echo $style; ?>"></div>
                    <div class="item-title"><?php echo htmlspecialchars($post['title']); ?></div>
                </a>
            <?php endforeach; ?>
        </div>
    </div>
</div>